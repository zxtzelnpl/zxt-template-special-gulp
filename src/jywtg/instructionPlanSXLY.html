<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    @@include('../commom/head.html',{
    "psd":"750",
    "px":"100"
    })
    <title>君银微投顾</title>
    <link rel="stylesheet" href="./main.css">
</head>
<body>
<div class="instruction">
    @@include('./common/instructionHead.html')

    <div class="instructionSXLY">
        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div class="instructionSXLYBox">
            <audio class="audioPlayBox" data-src="https://public.jyzqsh.com:447/test/test.mp3"></audio>
            <div class="sound"></div>
            <div class="audio">
                <p class="title">下跌只是暂时的上涨才刚刚开始下跌只是暂时的上涨才刚刚开始</p>
                <p class="info">来自首席投顾：<span>董齐安</span><span>6月20日</span></p>
                <p class="progress">
                    <span class="progressInner"></span>
                </p>
                <p class="timeShow">
                    <span class="timeNow">00:00</span>
                    <span class="timeTotal">--:--</span>
                </p>
            </div>
        </div>

        <div id="LoadControl" class="LoadControl"> <!--class中加入hide，即消失-->
            <img src="https://public.jyzqsh.com:447/jywtg1/loading.png" >
        </div>
    </div>
</div>
@@include('./common/foot.html')
</body>
<script>
  /*initial the head*/
  function initial(index){
    var head = document.querySelector('.instructionHead');
    var ps = head.querySelectorAll('p');
    ps[index].className = 'on';
  }
  initial(0);

  /*音频文件控制*/
  function formatTime(num){
    var str;
    if(num<10){
      str='0'+num;
    }
    else{
      str = String(num);
    }
    return str;
  }
  function audioOnCanPlay(e) {
    console.log('audioOnCanPlay');
    var audio = e.target;
    var canPlay = audio.getAttribute('data-canPlay');
    if(canPlay){
      return false;
    }
    var sound = e.target.nextElementSibling;
    var info = sound.nextElementSibling;
    sound.className = 'sound';

    var duration = audio.duration;
    var durationM = formatTime(Math.floor(duration/60));
    var durationS = formatTime(Math.floor(duration%60));
    audio.setAttribute('data-canPlay',true);
    info.querySelector('.timeTotal').innerHTML = durationM+':'+durationS;
  }
  function audioPlay(e) {
    console.log('audioPlay')
    var sound = e.target.nextElementSibling;
    console.log(sound);
    sound.className='sound play';
  }
  function audioPause(e) {
    console.log('audioPause')
    var sound = e.target.nextElementSibling;
    sound.className='sound';
  }
  function audioTimeUpdate(e) {
    var audio = e.target;
    var sound = e.target.nextElementSibling;
    var info = sound.nextElementSibling;

    var duration = audio.duration;
    var currentTime = audio.currentTime;
    var percent = Math.ceil(currentTime*100/duration) + '%';
    var currentTimeM = formatTime(Math.floor(currentTime/60));
    var currentTimeS = formatTime(Math.floor(currentTime%60));
    info.querySelector('.timeNow').innerHTML = currentTimeM+':'+currentTimeS;
    info.querySelector('.progressInner').style='width:'+percent;
  }
  function bindTheEventsToAuidos(){
    var index = 0;
    return function bindAudios(){
      var audios = document.querySelectorAll('audio');
      var length = audios.length;
      for(;index<length;index++){
        console.log(index);
        audios[index].addEventListener('canplay', audioOnCanPlay);
        audios[index].addEventListener('play', audioPlay);
        audios[index].addEventListener('pause', audioPause);
        audios[index].addEventListener('timeupdate', audioTimeUpdate);
      }
    }
  }
  var bindAudios = bindTheEventsToAuidos();
  bindAudios();
  document.addEventListener('click', function (e) {
    var sound = e.target;

    if(sound.className.indexOf('sound')===-1){return }

    var audio = sound.previousElementSibling;

    if (audio.paused) {
      var otherPlayingSounds = document.querySelectorAll('.sound.play');
      otherPlayingSounds.forEach(function(otherPlayingSound){
        var otherPlayingAudio = otherPlayingSound.previousElementSibling;
        otherPlayingAudio.pause();
      });
      audio.play();
    }
    else{
      audio.pause();
    }
  })

  /*音频文件LazyLoad*/
  var ShakeControl = null;
  var Height = window.innerHeight;
  function lazyLoad() {
    var readyAudios = document.querySelectorAll('audio[data-src]');
    readyAudios.forEach(function(audio){
      var sound = audio.nextElementSibling;
      var top = sound.getBoundingClientRect().top;
      if(top<=Height){
        sound.className='sound load';
        var src = audio.getAttribute('data-src');
        audio.setAttribute('src',src);
        audio.removeAttribute('data-src');
      }
    })
  }

  lazyLoad();
  window.onscroll = function(){
    clearTimeout(ShakeControl);
    ShakeControl = setTimeout(lazyLoad,300);
  }

  /*如果加载新的数据，需要执行lazyLoad*/
</script>
</html>
